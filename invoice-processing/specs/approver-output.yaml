# Approver Sub-Agent Output Spec
# Produces approval recommendation and journal entry

schema:
  invoice_id:
    type: string
    required: true

  timestamp:
    type: datetime
    required: true
    description: ISO 8601 timestamp of approval analysis

  recommendation:
    type: enum
    required: true
    values: [approve, approve_with_notes, query, reject, escalate]

  summary:
    type: string
    required: true
    description: "2-3 sentence summary of the invoice and recommendation"

  suggested_approver:
    type: object
    required: true
    fields:
      role: { type: string, description: "Role that should approve (e.g. Department Head)" }
      reason: { type: string, description: "Why this approval level" }
      escalated: { type: boolean, description: "Whether this was escalated above normal threshold" }

  queries:
    type: list
    required: false
    items:
      type: string
    description: "Questions that need answering (if recommendation is query)"

  rejection_reasons:
    type: list
    required: false
    items:
      type: string
    description: "Reasons for rejection (if recommendation is reject)"

  journal_entry:
    type: object
    required: true
    fields:
      entries:
        type: list
        items:
          type: object
          fields:
            account_code: { type: string }
            account_name: { type: string }
            debit: { type: float }
            credit: { type: float }
            description: { type: string }
      total_debit: { type: float }
      total_credit: { type: float }
      currency: { type: string }
      cost_centre: { type: string, required: false }
      posting_date: { type: date }
      reference: { type: string }

  risk_summary:
    type: object
    required: true
    fields:
      validation_status: { type: string }
      anomaly_risk: { type: string }
      fraud_risk_score: { type: float }
      flags: { type: list, items: { type: string } }

  confidence:
    type: float
    required: true
    min: 0.0
    max: 1.0

# Example output
example:
  invoice_id: "INV-2026-00142"
  timestamp: "2026-02-15T10:03:00Z"
  recommendation: approve
  summary: "Office supplies invoice from Acme Office Supplies Ltd for £540.00 (inc. VAT). All policy checks pass, vendor is approved, no anomalies detected. Recommend approval by Department Head."
  suggested_approver:
    role: "Department Head"
    reason: "Amount £540.00 is within department head threshold (£2,500)"
    escalated: false
  journal_entry:
    entries:
      - account_code: "6200"
        account_name: "Office Supplies"
        debit: 450.00
        credit: 0.00
        description: "Acme Office Supplies - INV ACM-2026-0891"
      - account_code: "2201"
        account_name: "Input VAT"
        debit: 90.00
        credit: 0.00
        description: "VAT on office supplies"
      - account_code: "2100"
        account_name: "Accounts Payable"
        debit: 0.00
        credit: 540.00
        description: "Acme Office Supplies Ltd - ACM-2026-0891"
    total_debit: 540.00
    total_credit: 540.00
    currency: "GBP"
    cost_centre: "ADMIN"
    posting_date: "2026-02-15"
    reference: "ACM-2026-0891 / PO-2026-0234"
  risk_summary:
    validation_status: "warning"
    anomaly_risk: "low"
    fraud_risk_score: 0.05
    flags: []
  confidence: 0.93
