# Context Assessor Sub-Agent Output Spec
# Assesses customer history, account value, and churn risk

schema:
  message_id:
    type: string
    required: true

  timestamp:
    type: datetime
    required: true

  data_available:
    type: boolean
    required: true
    description: Whether customer account data was found

  account:
    type: object
    required: true
    fields:
      account_id:
        type: string
        required: false
        description: Customer account identifier
      account_value_tier:
        type: enum
        required: true
        values: [enterprise, premium, standard, trial, unknown]
      annual_value_gbp:
        type: float
        required: false
        description: Estimated annual account value in GBP
      tenure_months:
        type: integer
        required: false
        description: Months as a customer
      is_vip:
        type: boolean
        required: true
        description: Whether the customer qualifies as VIP
      vip_criteria:
        type: list
        required: false
        items:
          type: string
        description: Which VIP thresholds were met

  contact_history:
    type: object
    required: true
    fields:
      contacts_last_30_days:
        type: integer
        required: true
        description: Number of contacts in the last 30 days
      open_tickets:
        type: integer
        required: true
        description: Currently unresolved tickets
      previous_escalations:
        type: integer
        required: true
        description: Escalations in last 90 days
      pattern:
        type: string
        required: false
        description: Summary of contact pattern (e.g. "3 contacts about same billing issue")
      is_repeat_contact:
        type: boolean
        required: true
        description: Whether this appears to be about a previously raised issue

  churn_risk:
    type: object
    required: true
    fields:
      score:
        type: float
        required: true
        min: 0.0
        max: 1.0
        description: Overall churn risk (0 = no risk, 1 = imminent churn)
      signals:
        type: list
        required: true
        items:
          type: object
          fields:
            signal:
              type: string
              description: The churn indicator
            source:
              type: enum
              values: [message-text, contact-history, account-data]
            weight:
              type: float
              min: 0.0
              max: 1.0
      recommendation:
        type: enum
        required: true
        values: [no-action, monitor, proactive-outreach, retention-intervention, urgent-retention]
        description: Recommended retention action

  context_confidence:
    type: float
    required: true
    min: 0.0
    max: 1.0
    description: Confidence in the overall context assessment

# Example output
example:
  message_id: "MSG-2026-00412"
  timestamp: "2026-02-15T14:22:03Z"
  data_available: true
  account:
    account_id: "ACC-7291034"
    account_value_tier: premium
    annual_value_gbp: 12500.00
    tenure_months: 38
    is_vip: true
    vip_criteria:
      - "Annual value above Â£10,000 threshold"
      - "Tenure above 3 years"
  contact_history:
    contacts_last_30_days: 4
    open_tickets: 2
    previous_escalations: 1
    pattern: "4 contacts in February, 2 about same billing discrepancy"
    is_repeat_contact: true
  churn_risk:
    score: 0.78
    signals:
      - signal: "Mentioned switching to competitor"
        source: message-text
        weight: 0.9
      - signal: "4 contacts in 30 days exceeds threshold"
        source: contact-history
        weight: 0.7
      - signal: "2 unresolved tickets"
        source: account-data
        weight: 0.6
    recommendation: urgent-retention
  context_confidence: 0.85
